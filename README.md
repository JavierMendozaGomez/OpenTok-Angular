OpenTok-Angular
===============

Angular directives and helper code to make working with OpenTok more Angularish.

It only works with the [OpenTok API for WebRTC](http://www.tokbox.com/opentok/webrtc/docs).

To see a demo of it all working check out [opentok-hangout](https://opentok-hangout.herokuapp.com/) ([github](https://github.com/aullman/opentok-hangout)).

## ot-session Directive

### Attributes

* apiKey - string attribute representing the apiKey of your application.
* sessionId - OpenTok sessionId generated by your server-side OpenTok SDK
* token - OpenTok token generated by your server-side OpenTok SDK
* publisher - a bi-directional binding. If this is specified session.publish() will be called on sessionConnected
* streams - A bi-directional binding to give you reference to the streams in a session
* session - A bi-directional binding if you need access to the session in your controller

### CSS Classes

This directive will automatically add a "session-connected" class when the session is connected and a "session-disconnected" class when it's disconnected. This allows you to write CSS rules to alter your UI based on these different states eg.

```css
ot-session.session-connected ~ #connectingUI {
    display: none;
}
```

### Events

This directive will $emit a 'sessionConnected' and 'sessionDisconnected' event corresponding to the OpenTok Session events. This event is $emit'd on the scope so parents of this directive can listen for them.

### Example Usage

```javascript
angular.module('myModule', ['opentok']);
```

```html
<ot-session apiKey="<%=apiKey%>" 
    sessionId="<%=sessionId%>" 
    token="<%=token%>" 
    publisher="publisher" 
    streams="streams" 
    session="session">
    
</ot-session>
```

## ot-publisher Directive

The publisher directive uses the power of Angular directives to allow you to define an OpenTok publisher directly in your DOM. This publisher creates a standalone publisher using TB.initPublisher and if you pass a reference to a session then session.publish will be called
when the publisher is ready. Alternatively you can pass a reference to this publisher to the 
ot-session directive and session.publish(publisher) will be called when the session connects.

### Dependencies

This directive requires the OpenTok JavaScript WebRTC library to be included in your page. For more details see [the opentok documentation](http://www.tokbox.com/opentok/webrtc/docs/js/reference/index.html).

### Attributes

* apiKey - string attribute representing the apiKey of your application.
* publisher - a bi-directional binding to your controller scope. This is a reference to the OpenTok [publisher object](http://www.tokbox.com/opentok/webrtc/docs/js/reference/Publisher.html).
* props - The properties you want to pass to the [session.publish](http://www.tokbox.com/opentok/webrtc/docs/js/reference/Session.html#publish) method.

### Example Usage

Include the OpenTok TB.min.js file and the opentok-angular.js file in your HTML.

```javascript
angular.module('myModule', ['opentok']);
```

```html
<ot-publisher apiKey="1127" 
    publisher="publisher" 
    props="{name: 'Adam'}">
</ot-publisher>
```


## ot-subscriber

The subscriber directive uses the power of Angular directives to allow you to define an OpenTok subscriber directly in your DOM. You will likely want to iterate over some kind of collection of streams and create subscriber objects for those streams. You can either maintain that list of streams yourself or you can use the streams provided by the ot-session directive.

### Dependencies

This directive requires the OpenTok JavaScript WebRTC library to be included in your page. For more details see [the opentok documentation](http://www.tokbox.com/opentok/webrtc/docs/js/reference/index.html).

### Attributes

* stream - The OpenTok stream you want to subscribe to
* session - The OpenTok Session object
* props - The properties you want to pass to the [session.subscribe](http://www.tokbox.com/opentok/webrtc/docs/js/reference/Session.html#subscribe) method.

### Example Usage

```javascript
angular.module('myModule', ['opentok']);
```

```html
<ot-subscriber ng-repeat="stream in streams" 
    stream="stream" 
    session="session" 
    props="{style: {nameDisplayMode: 'off'}}">
</ot-subscriber>
```

## ot-layout directive

This directive handles some nice layout logic for you to layout your publishers and subscribers. What it does is intelligently size a bunch of video elements to fit within a specified space. You can see a [demo here](http://aullman.github.io/opentok-layout-js/).

You can put Publishers and/or Subscribers into it and it will basically size the widgets to fit within the container and minimise whitespace.

### Dependencies

This directive uses the [opentok-layout-js](https://github.com/aullman/opentok-layout-js) component.

### Attributes

* props - These properties are passed to the TB.initLayoutContainer method of [opentok-layout-js](https://github.com/aullman/opentok-layout-js)

## Events

* otLayout - If you emit the "otLayout" event on the layout container's scope or a child of the layout container then it will call the `layout()` method of [opentok-layout-js](https://github.com/aullman/opentok-layout-js). The Publisher and Subscriber directives automatically trigger these events when they are loaded, it is also triggered on window resize. But if there are other times when you want to redraw the layout container you can trigger it manually.

### Example Usage

```javascript
angular.module('myModule', ['opentok']);
```

```html
<tb-layout props="{animate:true}">
    <ot-subscriber ng-repeat="stream in streams" 
        stream="stream" 
        session="session" 
        props="{style: {nameDisplayMode: 'off'}}">
    </ot-subscriber>
</tb-layout>
```

## Putting it all together

These directives are meant to all be used together, an example of them all being used can be found [here](demo.html). You will need to put in your own sessionId and token to get it to work. A more fully-functional demo can be found at: [opentok-hangout](https://opentok-hangout.herokuapp.com/).